このプログラムでは、台形制御を行うことを前提とし、それの目標値を修正するようにしている。
ここではその制御について説明する。

### Motor::run_angleでの目標値修正

ここでは、不十分な区間により三角制御に陥る場合の目標値修正について説明する。

まず、目標速度に到達するまでにどのくらいの時間がかかるかは、以下の式で導ける。

$(目標パワー) * \frac{(パワー100\%までにかかる時間[s])}{100}$

次に、モーターの速度プロファイルが原点を通る直線であると仮定する。これは不正確な近似であるが、完璧に正確な値を求める必要はなく、要求を満たしていると考えられる。\
このとき、目標値に到達するまでにどのくらい進むか(deg)は、三角形の面積を求めれば良く、

$(目標速度[deg/s]) * (かかる時間[s]) \div 2$

すなわち、

$(モーターの最大速度[deg/s] * (目標パワー/100)) * ((目標パワー) * \frac{(パワー100\%までにかかる時間[s])}{100}) \div 2$

展開して

$モーターの最大速度[deg/s] * (目標パワー)^2 * パワー100\%までにかかる時間[s] / 10'000 \div 2$

と求まる。\
これを加速減速それぞれに割り振る、つまり$\frac{|angle|}{2}$だけ進むようにすれば良いから、

$(前項) = \frac{|angle|}{2}$

ここで、求めたいのは目標パワーであるから、

$(目標パワー)^2 = 10'000 \div (モーターの最大速度[deg/s]) \div (パワー100\%までにかかる時間[s]) * |(angle[deg])| \div 2 * 2$

整数演算の切り捨てを考慮して、

$(目標パワー)^2 = 10'000 * |(angle[deg])| \div (モーターの最大速度[deg/s]) \div (パワー100\%までにかかる時間[s])$

となる。両辺の正の平方根を取り、(∵すべてのパラメータが正であることが明らか)

$(目標パワー) = \sqrt{10'000 * |(angle[deg])| \div (モーターの最大速度[deg/s]) \div (パワー100\%までにかかる時間[s])}$

と求まる。